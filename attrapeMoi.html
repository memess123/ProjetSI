<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Réflexe : Chasse aux Couleurs</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            overflow: hidden;
        }

        #ui {
            position: absolute;
            top: 20px;
            text-align: center;
            background: white;
            padding: 20px 40px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 10;
            border-bottom: 8px solid #ccc; /* La couleur cible sera ici */
            transition: border-color 0.3s;
        }

        .stats { font-size: 1.2rem; margin: 5px; font-weight: bold; }

        .difficulty-selector { margin-bottom: 10px; }
        .btn-diff {
            padding: 5px 15px;
            margin: 0 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: #eee;
        }
        .btn-diff.active { background: #333; color: white; }

        .game-button {
            position: absolute;
            width: 80px;
            height: 80px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            font-weight: bold;
            color: white;
            transition: transform 0.1s;
        }

        .game-button:active { transform: scale(0.9); }

        .hidden { display: none; }
        #message { font-size: 1.5rem; margin-top: 15px; }
        #restart { padding: 10px 20px; cursor: pointer; background: #2ed573; border: none; color: white; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="difficulty-selector" id="difficulty-box">
            <button class="btn-diff active" onclick="setDifficulty(2, this)">Facile</button>
            <button class="btn-diff" onclick="setDifficulty(4, this)">Moyen</button>
            <button class="btn-diff" onclick="setDifficulty(6, this)">Expert</button>
        </div>
        
        <div class="stats">Cible : <span id="color-name">...</span></div>
        <div class="stats">Chrono : <span id="timer">0.0</span>s | Score : <span id="score">0</span>/10</div>

        <div id="end-screen" class="hidden">
            <p id="message"></p>
            <button id="restart" onclick="resetGame()">Recommencer</button>
        </div>
    </div>

    <div id="game-container"></div>

    <script>
        const colors = [
            { name: 'Rouge', hex: '#ff4757' },
            { name: 'Bleu', hex: '#1e90ff' },
            { name: 'Vert', hex: '#2ed573' },
            { name: 'Jaune', hex: '#ffa502' },
            { name: 'Violet', hex: '#5352ed' },
            { name: 'Orange', hex: '#ff7f50' }
        ];

        let score = 0;
        let startTime;
        let timerInterval;
        let gameActive = false;
        let targetColor = {};
        let numButtons = 2;

        const ui = document.getElementById('ui');
        const gameContainer = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const colorNameDisplay = document.getElementById('color-name');
        const endScreen = document.getElementById('end-screen');
        const message = document.getElementById('message');

        function setDifficulty(n, btn) {
            numButtons = n;
            document.querySelectorAll('.btn-diff').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            resetGame();
        }

        function createButtons() {
            gameContainer.innerHTML = '';
            // On mélange les couleurs et on prend les N premières
            const shuffled = [...colors].sort(() => 0.5 - Math.random()).slice(0, numButtons);
            
            shuffled.forEach(color => {
                const btn = document.createElement('button');
                btn.className = 'game-button';
                btn.style.backgroundColor = color.hex;
                btn.onclick = () => handleButtonClick(color);
                gameContainer.appendChild(btn);
            });
            return shuffled;
        }

        function moveButtons() {
            const btns = document.querySelectorAll('.game-button');
            btns.forEach(btn => {
                const x = Math.random() * (window.innerWidth - 100);
                const y = Math.random() * (window.innerHeight - 150);
                btn.style.left = `${Math.max(20, x)}px`;
                btn.style.top = `${Math.max(180, y)}px`;
            });
        }

        function pickNewTarget(availableColors) {
            targetColor = availableColors[Math.floor(Math.random() * availableColors.length)];
            ui.style.borderColor = targetColor.hex;
            colorNameDisplay.textContent = targetColor.name;
            colorNameDisplay.style.color = targetColor.hex;
        }

        function handleButtonClick(clickedColor) {
            if (score === 0 && !gameActive) {
                gameActive = true;
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 100);
                document.getElementById('difficulty-box').classList.add('hidden');
            }

            if (clickedColor.hex === targetColor.hex) {
                score++;
                scoreDisplay.textContent = score;
                if (score >= 10) {
                    endGame();
                } else {
                    const newColors = createButtons();
                    pickNewTarget(newColors);
                    moveButtons();
                }
            } else {
                // Flash rouge sur l'UI si erreur
                ui.style.backgroundColor = "#ffcccc";
                setTimeout(() => ui.style.backgroundColor = "white", 200);
            }
        }

        function updateTimer() {
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
            timerDisplay.textContent = elapsed;
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            gameContainer.innerHTML = '';
            endScreen.classList.remove('hidden');
            message.textContent = `Bravo ! Temps : ${timerDisplay.textContent}s`;
        }

        function resetGame() {
            score = 0;
            gameActive = false;
            clearInterval(timerInterval);
            scoreDisplay.textContent = "0";
            timerDisplay.textContent = "0.0";
            endScreen.classList.add('hidden');
            document.getElementById('difficulty-box').classList.remove('hidden');
            const available = createButtons();
            pickNewTarget(available);
            moveButtons();
        }

        // Initialisation
        resetGame();

    </script>
</body>
</html>
